<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-sRIl4kxILFvY47J16cr9ZwB07vP4J8+LH7qKQnuqkuIAvNWLzeN8tE5YBujZqJLB" crossorigin="anonymous" />
  <link rel="stylesheet" href="/css/admin-style.css" />
  <link rel="stylesheet" href="/lib/css/sweetalert2.min.css">
  <script src="/lib/js/sweetalert2.all.min.js"></script>
  <!-- jquery -->
   <script src="/lib/js/jquery-3.7.1.js"></script>
   <script src="/lib/js/tinymce.min.js"></script>
  <style>
    body {
      padding: 0 50px;
      max-width: calc(80% -32px);
      width: 100%;
      margin: 0 auto;
    }

    .input-row {
      display: flex;
      gap: 0;
      /*khoang cach giua cac input*/
      margin-bottom: 20px;
      flex-wrap: wrap;
    }

    .input-small {
      /* border-bottom-left-radius: 10px; */
      /* border-top-left-radius: 10px; */
      border-bottom-right-radius: 0;
      border-top-right-radius: 0;
      flex: 2;
      min-width: 100px;
    }

    .input-large {
      border-bottom-left-radius: 0;
      border-top-left-radius: 0;
      flex: 8;
      min-width: 100px;
    }

    @media (max-width: 768px) {

      .input-small,
      .input-large {
        flex: 100%;
        /* border-radius: 10px; */
      }
    }

    /* input group */
    .input-group {
      display: flex;
      flex-direction: column;
      width: 100%;
      max-width: 500px;
      margin-bottom: 30px;
    }

    .input-top,
    .input-bottom {
      border: 1px solid #ccc;
      /* padding: 10px; */
      line-height: 1.5;
      font-size: 16px;
      outline: none;
      /* ép giống nhau */
      /* display: block;
  width: 100%;
  padding: 10px;
  margin: 0;
  line-height: 1.5;
  box-sizing: border-box;
  font-family: inherit; */
    }

    .input-top {
      margin-left: -1px;

      border-bottom: none;
      /*
         loại bỏ viền dưới để nối liền */
      border-radius: 5px 5px 0 0;
    }

    .input-bottom {
      border-radius: 0 0 5px 5px;
      resize: vertical;
      /* cho phép kéo chiều cao */
      min-height: 100px;
    }
    .preview{
      width: 250px;   /* Giới hạn chiều ngang */
      height: 150px;  /* Giới hạn chiều cao */
      margin: 20px 0 30px 0;
    }
    .preview img {
      width: 100%;
      height: 100%;
  object-fit: cover; /* Thu gọn vừa khung mà không bị méo */
  display: none;      /* Mặc định ẩn, chỉ show khi có ảnh */
  border: 1px solid #ddd;
  border-radius: 6px;
  margin-top: 8px;
}
  </style>
</head>

<body>
  <h1>dashboard admin</h1>
  <hr />
  <button id="btnSave" type="button">Save Settings</button>
<div id="result"></div>
  <!-- hero -->
  <div class="section">
    <button class="section-toggle" data-label="Hero section">
      +Hero Section
    </button>
    <div class="section-content">
      <div class="form-group">
        <label for="hero_title" class="form-label">Title</label>
        <input type="text" id="hero_title" name="hero_title" class="form-control" value="<%=ps.hero.title%>" placeholder="title" />
      </div>
      <div class="form-group">
        <label for="hero_subtitle" class="form-label">Sub-title</label>
        <textarea id="hero_subtitle" name="hero_subtitle" class="form-control"><%=ps.hero.subtitle%></textarea>
      </div>
      <div class="form-group">
        <label for="hero_image" class="form-label">Choose img</label>
        <input type="file" id="hero_image" name="hero_image" class="form-control" />
        <div class="preview">
          <img src="<%= ps?.hero?.image ? ('/uploads/'+ps.hero.image) : '/img/default.png' %>" alt="" style="display: block;" />
          <input type="hidden" name="hero_image.file_old" value="<%= ps.hero.image %>" />
        </div>
      </div>
    </div>
  </div>

  <!-- issue -->
  <div class="section">
    <button class="section-toggle" data-label="Issue section">
      Issue section
    </button>
    <div class="section-content">
      <div class="form-group">
        <label for="issue_title" class="form-label">Title</label>
        <input type="text" id="issue_title" name="issue_title" class="form-control" value="<%=ps.issue.title%>" placeholder="title" />
      </div>
      <br />
      <div class="row">
        <div class="col-6">
          <div class="form-control">
            <input type="text" name="issue_images[0].desc" placeholder="img-desc" value="<%=ps.issue.images[0].desc%>"  class="form-control" />
            <input type="file" name="issue_images[0].file" class="form-control" />
            <div class="preview">
              <img src="<%= ps?.issue?.images[0]?.file ? ('/uploads/'+ps.issue.images[0].file) : '/img/default.png' %>" alt="" style="display: block;" />
              <input type="hidden" name="issue_images[0].file_old" value="<%= ps.issue.images[0]?.file ? ps.issue.images[0].file : null%>" />
            </div>

            <input type="text" name="issue_images[1].desc" placeholder="img-desc" value="<%=ps.issue.images[1].desc%>" class="form-control" />
            <input type="file" name="issue_images[1].file" class="form-control" />
            <div class="preview">
             <img src="<%= ps?.issue?.images[1]?.file ? ('/uploads/'+ps.issue.images[1].file) : '/img/default.png' %>" alt="" style="display: block;" />
             <input type="hidden" name="issue_images[1].file_old" value="<%= ps.issue.images[1]?.file ? ps.issue.images[1].file : null%>" />
            </div>
          </div>
        </div>
        <div class="col-6">
          <div class="form-control">
            <input type="text" name="issue_images[2].desc" placeholder="img-desc" value="<%=ps.issue.images[2].desc%>" class="form-control" />
            <input type="file" name="issue_images[2].file" class="form-control" />
            <div class="preview">
              <img src="<%= ps?.issue?.images[2]?.file ? ('/uploads/'+ps.issue.images[2].file) : '/img/default.png' %>" alt="" style="display: block;" />
             <input type="hidden" name="issue_images[2].file_old" value="<%= ps.issue.images[2]?.file ? ps.issue.images[2].file : null%>" />
            </div>

            <input type="text" name="issue_images[3].desc" placeholder="img-desc" value="<%=ps.issue.images[3].desc%>" class="form-control" />
            <input type="file" name="issue_images[3].file" class="form-control" />
            <div class="preview">
              <img src="<%= ps?.issue?.images[3]?.file ? ('/uploads/'+ps.issue.images[3].file) : '/img/default.png' %>" alt="" style="display: block;" />
             <input type="hidden" name="issue_images[3].file_old" value="<%= ps.issue.images[3]?.file ? ps.issue.images[3].file : null%>" />
            </div>
          </div>
        </div>
      </div>
      <div class="form-group">
        <label for="issue_summary" class="form-label">Summary</label>
        <textarea id="issue_summary" name="issue_summary" class="form-control"><%=ps.issue.summary%></textarea>
      </div>
    </div>
  </div>

  <!-- solution -->
  <div class="section">
    <button class="section-toggle" data-label="Solution">
      Solution section
    </button>
    <div class="section-content">
      <!-- Title -->
      <div class="form-group">
        <label for="solution_title" class="form-label">Title</label>
        <input type="text" id="solution_title" name="solution_title" value="<%=ps.solution.title%>" class="form-control" placeholder="title" />
      </div>
      <br />

      <div class="row">
        <!-- Card 0 -->
        <div class="col-6">
          <div class="form-group">
            <label for="solution_cards_0_title">Card 1</label>
            <input type="text" id="solution_cards_0_title" value="<%=ps.solution.cards[0].title%>" name="solution_cards[0].title" class="form-control"
              placeholder="Card title" />
            <textarea id="solution_cards_0_desc" name="solution_cards[0].desc"  class="form-control"
              placeholder="Card description"><%=ps.solution.cards[0].desc %></textarea>
          </div>

          <!-- Card 1 -->
          <div class="form-group">
            <label for="solution_cards_1_title">Card 2</label>
            <input type="text" id="solution_cards_1_title" value="<%=ps.solution.cards[1].title%>"  name="solution_cards[1].title" class="form-control"
              placeholder="Card title" />
            <textarea id="solution_cards_1_desc" name="solution_cards[1].desc" class="form-control"
              placeholder="Card description"><%=ps.solution.cards[1].desc %></textarea>
          </div>
        </div>

        <!-- Card 2 + 3 -->
        <div class="col-6">
          <div class="form-group">
            <label for="solution_cards_2_title">Card 3</label>
            <input type="text" id="solution_cards_2_title" value="<%=ps.solution.cards[2].title%>" name="solution_cards[2].title" class="form-control"
              placeholder="Card title" />
            <textarea id="solution_cards_2_desc" name="solution_cards[2].desc" class="form-control"
              placeholder="Card description"><%=ps.solution.cards[2].desc %></textarea>
          </div>

          <div class="form-group">
            <label for="solution_cards_3_title">Card 4</label>
            <input type="text" id="solution_cards_3_title" value="<%=ps.solution.cards[3].title%>" name="solution_cards[3].title" class="form-control"
              placeholder="Card title" />
            <textarea id="solution_cards_3_desc" name="solution_cards[3].desc" class="form-control"
              placeholder="Card description"><%=ps.solution.cards[3].desc %></textarea>
          </div>
        </div>

        <!-- Card 5 -->
        <div class="form-group">
          <label for="solution_cards_4_title">Card 5</label>
          <input type="text" id="solution_cards_4_title" value="<%=ps.solution.cards[4].title%>" name="solution_cards[4].title" class="form-control"
            placeholder="Card title" />
          <textarea id="solution_cards_4_desc" name="solution_cards[4].desc" class="form-control"
            placeholder="Card description"><%=ps.solution.cards[4].desc %></textarea>
        </div>

        <!-- Video -->
        <div class="form-group">
          <label for="solution_video" class="form-label">Link video</label>
          <input type="text" id="solution_video" name="solution_video" class="form-control" value="<%=ps.solution.video%>" placeholder="video link" />
        </div>
      </div>
    </div>
  </div>

  <!-- why choose me -->
  <div class="section">
    <button class="section-toggle" data-label="Why choose us">
      My choose us
    </button>
    <div class="section-content">
      <!-- Title -->
      <div class="form-group">
        <label for="why_title" class="form-label">Title</label>
        <input type="text" id="why_title" name="why_title" value="<%=ps.why.title%>" class="form-control" placeholder="title" />
      </div>
      <br />

      <!-- Card with image + 3 lines -->
      <div class="row">
        <div class="col-4">
          <div class="form-group">
            <input type="file" id="why_cards_0_image" name="why_cards[0].image" class="form-control" />
            <div class="preview">
              <img src="" alt="" />
            </div>
          </div>
        </div>
        <div class="col-8">
          <div class="form-group">
            <input type="text" id="why_cards_0_line1" name="why_cards[0].line1" value="<%=ps.why.cards.line1%>" class="form-control"
              placeholder="Line 1" />
            <br />
            <input type="text" id="why_cards_0_line2" name="why_cards[0].line2" value="<%=ps.why.cards.line2%>" class="form-control"
              placeholder="Line 2" />
            <br />
            <input type="text" id="why_cards_0_line3" name="why_cards[0].line3"value="<%=ps.why.cards.line3%>" class="form-control"
              placeholder="Line 3" />
          </div>
        </div>
      </div>

      <!-- Sub-title 1 -->
      <br />
      <hr />
      <br />
      <div class="form-group">
        <label for="why_subtitles_0" class="form-label">Sub-title</label>
        <input type="text" id="why_subtitle_01" name="why_subtitle_01" value="<%=ps.why.sub_title_01%>" class="form-control" placeholder="Sub-title" />
      </div>

      <!-- Sub-title 2 + extra cards -->
      <br />
      <hr />
      <br />
      <div class="form-group">
        <label for="why_subtitles_1">Sub-title</label>
        <input type="text" id="why_subtitle_02" value="<%=ps.why.sub_title_02%>" name="why_subtitle_02" class="form-control" placeholder="Sub-title" />
      </div>

      <div class="form-group">
        <label for="why_extra_cards_0" class="label">Card1</label>
        <textarea id="why_extra_cards_0" name="why_extra_cards[0]" class="form-control"
          placeholder="Card 1 content"><%=ps.why.extracards[0]%></textarea>
        <br />

        <label for="why_extra_cards_1" class="label">Card2</label>
        <textarea id="why_extra_cards_1" name="why_extra_cards[1]" class="form-control"
          placeholder="Card 2 content"><%=ps.why.extracards[1]%></textarea>
        <br />

        <label for="why_extra_cards_2" class="label">Card3</label>
        <textarea id="why_extra_cards_2" name="why_extra_cards[2]" class="form-control"
          placeholder="Card 3 content"><%=ps.why.extracards[2]%></textarea>
        <br />
      </div>
    </div>
  </div>

  <!-- certificate -->
  <div class="section">
    <button class="section-toggle" data-label="Certificate">
      Certificate
    </button>
    <div class="section-content">
      <!-- Title -->
      <div class="form-group">
        <label for="certificate_title" class="label">Title</label>
        <input type="text" id="certificate_title" name="certificate_title" class="form-control" placeholder="title" />
      </div>
      <br />

      <div class="row">
        <!-- Col 1 -->
        <div class="col-6">
          <!-- Certificate 0 -->
          <input type="file" id="certificates_0" name="certificates[0]" class="form-control" />
          <div class="preview">
            <img src="" alt="" />
          </div>
          <br />

          <!-- Certificate 1 -->
          <input type="file" id="certificates_1" name="certificates[1]" class="form-control" />
          <div class="preview">
            <img src="" alt="" />
          </div>
        </div>

        <!-- Col 2 -->
        <div class="col-6">
          <!-- Certificate 2 -->
          <input type="file" id="certificates_2" name="certificates[2]" class="form-control" />
          <div class="preview">
            <img src="" alt="" />
          </div>
          <br />

          <!-- Certificate 3 -->
          <input type="file" id="certificates_3" name="certificates[3]" class="form-control" />
          <div class="preview">
            <img src="" alt="" />
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- survay -->
  <div class="section">
    <button class="section-toggle" data-label="Survey">Survey</button>
    <div class="section-content">
      <!-- Title -->
      <div class="form-group">
        <label for="survey_title" class="label">Title</label>
        <input type="text" id="survey_title" value="<%=ps.survey.title%>" name="survey_title" class="form-control" placeholder="title" />
      </div>
      <br />

      <div class="row">
        <label for="" class="form-label">(%number)/text</label>

        <!-- Col 1 -->
        <div class="col-6">
          <div class="form-group">
            <!-- Item 0 -->
            <div class="input-row">
              <input type="text" id="survey_items_0_percent" value="<%=ps.survey.items[0].percent%>" name="survey_items[0].percent"
                class="input-small form-control" placeholder="%" />
              <textarea id="survey_items_0_text" name="survey_items[0].text" class="input-large form-control"
                placeholder="Description"><%=ps.survey.items[0].text%></textarea>
            </div>

            <!-- Item 1 -->
            <div class="input-row">
              <input type="text" id="survey_items_1_percent" value="<%=ps.survey.items[1].percent%>" name="survey_items[1].percent"
                class="input-small form-control" placeholder="%" />
              <textarea id="survey_items_1_text" name="survey_items[1].text" class="input-large form-control"
                placeholder="Description"><%=ps.survey.items[1].text%></textarea>
            </div>
          </div>
        </div>

        <!-- Col 2 -->
        <div class="col-6">
          <div class="form-group">
            <!-- Item 2 -->
            <div class="input-row">
              <input type="text" id="survey_items_2_percent" value="<%=ps.survey.items[2].percent%>" name="survey_items[2].percent"
                class="input-small form-control" placeholder="%" />
              <textarea id="survey_items_2_text" name="survey_items[2].text" class="input-large form-control"
                placeholder="Description"><%=ps.survey.items[2].text%></textarea>
            </div>

            <!-- Item 3 -->
            <div class="input-row">
              <input type="text" id="survey_items_3_percent" value="<%=ps.survey.items[3].percent%>" name="survey_items[3].percent"
                class="input-small form-control" placeholder="%" />
              <textarea id="survey_items_3_text" name="survey_items[3].text" class="input-large form-control"
                placeholder="Description"><%=ps.survey.items[3].text%></textarea>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- feedback -->
  <div class="section">
    <button class="section-toggle" data-label="Feedback">Feedback</button>
    <div class="section-content">
      <!-- Title -->
      <div class="group">
        <label for="feedback_title" class="form-label">Title</label>
        <input type="text" value="<%=ps.feedback.title%>" id="feedback_title" name="feedback_title" class="form-control" placeholder="Title" />
      </div>

      <!-- Video -->
      <div class="group">
        <label for="feedback_video" class="form-label">Video link</label>
        <input type="text" value="<%=ps.feedback.video%>" id="feedback_video" name="feedback_video" class="form-control" placeholder="Video link" />
      </div>
    </div>
  </div>

  <!-- faq -->
  <div class="section">
    <button class="section-toggle" data-label="Faq">Faq</button>
    <div class="section-content">
      <!-- Title -->
      <div class="form-group">
        <label for="faq_title" class="label">Title</label>
        <input type="text" id="faq_title" value="<%=ps.faq.title%>" name="faq_title" class="form-control" placeholder="Title" />
      </div>
      <br />

      <div class="row">
        <!-- Col 1 -->
        <div class="col-6">
          <!-- Item 0 -->
          <div class="input-group">
            <input type="text" id="faq_items_0_question" value="<%=ps.faq.items[0].question%>" name="faq_items[0].question" placeholder="Tiêu đề"
              class="input-top" />
            <textarea id="faq_items_0_answer" name="faq_items[0].answer"  placeholder="Nội dung chi tiết"
              class="input-bottom"><%=ps.faq.items[0].answer%></textarea>
          </div>

          <!-- Item 1 -->
          <div class="input-group">
            <input type="text" id="faq_items_1_question"value="<%=ps.faq.items[1].question%>" name="faq_items[1].question" placeholder="Tiêu đề"
              class="input-top" />
            <textarea id="faq_items_1_answer"  name="faq_items[1].answer" placeholder="Nội dung chi tiết"
              class="input-bottom"><%=ps.faq.items[1].answer%></textarea>
          </div>
        </div>

        <!-- Col 2 -->
        <div class="col-6">
          <!-- Item 2 -->
          <div class="input-group">
            <input type="text" id="faq_items_2_question" value="<%=ps.faq.items[2].question%>" name="faq_items[2].question" placeholder="Tiêu đề"
              class="input-top" />
            <textarea id="faq_items_2_answer" name="faq_items[2].answer" placeholder="Nội dung chi tiết"
              class="input-bottom"><%=ps.faq.items[2].answer%></textarea>
          </div>

          <!-- Item 3 -->
          <div class="input-group">
            <input type="text" id="faq_items_3_question" value="<%=ps.faq.items[3].question%>" name="faq_items[3].question" placeholder="Tiêu đề"
              class="input-top" />
            <textarea id="faq_items_3_answer" name="faq_items[3].answer" placeholder="Nội dung chi tiết"
              class="input-bottom"><%=ps.faq.items[3].answer%></textarea>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- warranty  contact introlduce -->
  <div class="section">
    <button class="section-toggle" data-label="Warranty + Contact + Introduce">
      Warranty + Contact + Introduce
    </button>
    <div class="section-content">
      <!-- Warranty -->
      <div class="form-group">
        <label for="warranty_title" class="label">Title</label>
        <input type="text" id="warranty_title" value="<%=ps.warranty.title%>" name="warranty_title" class="form-control"
          placeholder="Warranty title" />
      </div>
      <br />

      <div class="row">
        <div class="col-6">
          <div class="form-group">
            <input type="text" id="warranty_items_0" value="<%=ps.warranty.items[0]%>" name="warranty_items[0].one" class="form-control"
              placeholder="Warranty info 1" />
            <br />
            <input type="text" id="warranty_items_1"value="<%=ps.warranty.items[1]%>" name="warranty_items[1].two" class="form-control"
              placeholder="Warranty info 2" />
          </div>
        </div>

        <div class="col-6">
          <div class="form-group">
            <input type="text" id="warranty_items_2"value="<%=ps.warranty.items[2]%>" name="warranty_items[2].three" class="form-control"
              placeholder="Warranty info 3" />
            <br />
            <input type="text" id="warranty_items_3"value="<%=ps.warranty.items[3]%>" name="warranty_items[3].four" class="form-control"
              placeholder="Warranty info 4" />
          </div>
        </div>
      </div>

      <br />
      <hr />
      <br />

      <!-- Contact -->
      <div class="form-group">
        <label for="contact_title" class="label">Title</label>
        <input type="text" value="<%=ps.contact.title%>" id="contact_title" name="contact_title" class="form-control" placeholder="Contact title">
        <label for="" class="form-label">Desc</label>
        <textarea id="contact_desc" name="contact_desc" class="form-control" placeholder="Contact title"><%=ps.contact.desc%></textarea>
      </div>

      <br />
      <hr />
      <br />

      <!-- Introduce -->
      <div class="introduce">
        <div class="form-group">
          <label for="introduce_title" class="label">Title</label>
          <input type="text" id="introduce_title" value="<%=ps.introduce.title%>" name="introduce_title" class="form-control"
            placeholder="Introduce title" />
          <br />

          <label for="introduce_desc" class="form-label">Desc</label>
          <textarea id="introduce_desc" name="introduce_desc" class="form-control"
            placeholder="Introduce description"><%=ps.introduce.desc%></textarea>
          <br />

          <input type="file" id="introduce_image" name="introduce_image" class="form-control" />
          <div class="preview">
            <img src="" alt="" />
          </div>
        </div>
      </div>
    </div>
  </div>

  <!--  -->

  <script>
    $(document).ready(function() {
      // alert("jQuery loaded ✅");
      $("#btnSave").click(function (e) {
    e.preventDefault();

    // gom toàn bộ input/textarea/file trong body vào FormData
    let formData = new FormData();
    $("input[name], textarea[name], select[name]").each(function () {
      let type = $(this).attr("type");
      let name = $(this).attr("name");

      if (type === "file") {
        if (this.files.length > 0) {
          formData.append(name, this.files[0]);
        }
      } else {
        formData.append(name, $(this).val());
      }
    });

    $.ajax({
      url: "/admin/page-setting",
      type: "POST",
      data: formData,
      processData: false, // bắt buộc với FormData
      contentType: false, // bắt buộc với FormData
      success: function (res) {
        console.log(res)
        console.log("Server response:", res);
        $("#result").html("<pre>" + JSON.stringify(res, null, 2) + "</pre>");
        alert("Lưu thành công!");
      },
      error: function (xhr, status, error) {
        console.error("Error:", error);
        $("#result").text("Có lỗi xảy ra: " + error);
        alert("Lỗi khi lưu dữ liệu!");
      }
    });
  });
    })
  </script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.8/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-FKyoEForCGlyvwx9Hj09JcYn3nv7wiPVlz7YYwJrWVcXK/BmnVDxM+D2scQbITxI"
    crossorigin="anonymous"></script>
  <!-- script -->
  <script>
    document.querySelectorAll(".section-toggle").forEach((button) => {
      button.addEventListener("click", () => {
        const content = button.nextElementSibling;
        const label = button.getAttribute("data-label");
        //toggle mo rong / thu gon
        if (content.style.display === "block") {
          content.style.display = "none";
          button.textContent = "+ " + label;
        } else {
          content.style.display = "block";
          button.textContent = "- " + label;
        }
      });
    });
    // 
    // Tìm tất cả input type="file"
    // Tìm tất cả input type="file"
const fileInputs = document.querySelectorAll('input[type="file"]');

fileInputs.forEach(input => {
  input.addEventListener("change", function (event) {
    const file = event.target.files[0];
    if (file && file.type.startsWith("image/")) {
      const reader = new FileReader();
      reader.onload = function (e) {
        // Tìm đúng preview img nằm cùng group với input này
        const previewImg = input.nextElementSibling?.querySelector("img");
        if (previewImg) {
          previewImg.src = e.target.result;
          previewImg.style.display = "block";
        }
      };
      reader.readAsDataURL(file);
    }
  });
});


  </script>
</body>

</html>